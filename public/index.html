<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion de Stock Bar - Administration</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <link href="css/styles.css" rel="stylesheet">
</head>
<body>
  <div id="app">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">Bar Stock Manager</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <!-- Sélecteur d'entreprise -->
          <div class="navbar-nav me-auto">
            <div class="nav-item dropdown d-none" id="company-selector-container">
              <button class="btn btn-outline-light dropdown-toggle" type="button" id="companyDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-building"></i>
                <span id="selected-company-name">Sélectionner une entreprise</span>
              </button>
              <ul class="dropdown-menu" id="company-dropdown-menu">
                <li><a class="dropdown-item" href="#" data-company-id="">Toutes les entreprises</a></li>
                <li><hr class="dropdown-divider"></li>
                <!-- Les entreprises seront chargées ici -->
              </ul>
            </div>
          </div>
          
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="#dashboard">Tableau de bord</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#companies">Entreprises</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#bars">Bars</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#products">Produits</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#stocks">Stocks</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#reserve">Réserve</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#multi-reserves">Réserves</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#users">Utilisateurs</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#history">Historique</a>
            </li>
          </ul>
          <ul class="navbar-nav ms-auto">
            <li class="nav-item" id="nav-login">
              <a class="nav-link" href="login.html">Connexion</a>
            </li>
            <li class="nav-item d-none" id="nav-logout">
              <span class="navbar-text me-3" id="user-info"></span>
              <a class="nav-link" href="login.html" class="me-2">Inscription</a>
              <a class="nav-link" href="#" id="logout-btn">Déconnexion</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid mt-4">
      <!-- Alerte pour les messages -->
      <div class="alert d-none" role="alert" id="alert-container"></div>
      
      <!-- Contenu des pages -->
      <!-- Page de connexion -->
      <div id="login-page" class="d-none">
        <div class="row justify-content-center">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h4>Connexion</h4>
              </div>
              <div class="card-body">
                <form id="login-form">
                  <div class="mb-3">
                    <label for="username" class="form-label">Nom d'utilisateur</label>
                    <input type="text" class="form-control" id="username" required>
                  </div>
                  <div class="mb-3">
                    <label for="password" class="form-label">Mot de passe</label>
                    <input type="password" class="form-control" id="password" required>
                  </div>
                  <button type="submit" class="btn btn-primary">Se connecter</button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tableau de bord -->
      <div id="dashboard-page" class="d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2>Tableau de bord</h2>
          <div class="d-flex align-items-center gap-3">
            <button class="btn btn-outline-secondary btn-sm d-none" id="reset-company-btn" onclick="resetCompanySelection()">
              <i class="bi bi-arrow-clockwise"></i> Voir toutes les entreprises
            </button>
            <div id="current-company-info" class="d-none">
              <span class="badge bg-primary fs-6">
                <i class="bi bi-building"></i>
                <span id="dashboard-company-name">Toutes les entreprises</span>
              </span>
            </div>
          </div>
        </div>
        
        <div class="row">
          <div class="col-md-3">
            <div class="card mb-4">
              <div class="card-header">
                <h5>Entreprises</h5>
              </div>
              <div class="card-body">
                <div id="active-companies-count">
                  <h3>0</h3>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-3">
            <div class="card mb-4">
              <div class="card-header">
                <h5>Bars actifs</h5>
              </div>
              <div class="card-body">
                <div id="active-bars-count">
                  <h3>0</h3>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-3">
            <div class="card mb-4">
              <div class="card-header">
                <h5>Produits disponibles</h5>
              </div>
              <div class="card-body">
                <div id="active-products-count">
                  <h3>0</h3>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-3">
            <div class="card mb-4">
              <div class="card-header">
                <h5>Alertes de stock</h5>
              </div>
              <div class="card-body">
                <div id="low-stock-count">
                  <h3>0</h3>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row mt-4">
          <div class="col-12">
            <div class="card">
              <div class="card-header d-flex justify-content-between align-items-center">
                <h5>État des stocks par bar</h5>
                <button class="btn btn-sm btn-outline-primary" id="refresh-all-bars-btn">
                  <i class="bi bi-arrow-clockwise"></i> Actualiser tout
                </button>
              </div>
              <div class="card-body">
                <div id="all-bars-container">
                  <div class="text-center text-muted py-4">
                    <div class="spinner-border" role="status">
                      <span class="visually-hidden">Chargement...</span>
                    </div>
                    <p class="mt-2">Chargement des données des bars...</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Companies Page -->
      <div id="companies-page" class="d-none">
        <div class="d-flex justify-content-between align-items-center">
          <h2>Gestion des entreprises</h2>
          <button class="btn btn-primary" id="add-company-btn">Ajouter une entreprise</button>
        </div>
        <div class="table-responsive mt-3">
          <table class="table">
            <thead>
              <tr>
                <th>Nom</th>
                <th>Adresse</th>
                <th>Téléphone</th>
                <th>Email</th>
                <th>Bars</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="companies-table-body">
            </tbody>
          </table>
        </div>
      </div>

      <!-- Bars Page -->
      <div id="bars-page" class="d-none">
        <div class="d-flex justify-content-between align-items-center">
          <h2>Gestion des bars</h2>
          <button class="btn btn-primary" id="add-bar-btn">Ajouter un bar</button>
        </div>
        <div class="table-responsive mt-3">
          <table class="table">
            <thead>
              <tr>
                <th>Nom</th>
                <th>Entreprise</th>
                <th>Emplacement</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="bars-table-body">
            </tbody>
          </table>
        </div>
      </div>

      <!-- Products Page -->
      <div id="products-page" class="d-none">
        <div class="d-flex justify-content-between align-items-center">
          <h2>Gestion des produits</h2>
          <button class="btn btn-primary" id="add-product-btn">Ajouter un produit</button>
        </div>
        <div class="table-responsive mt-3">
          <table class="table">
            <thead>
              <tr>
                <th>Nom</th>
                <th>Marque</th>
                <th>Catégorie</th>
                <th>Formats</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="products-table-body">
            </tbody>
          </table>
        </div>
      </div>

      <!-- Stocks Page -->
      <div id="stocks-page" class="d-none">
        <h2>Gestion des stocks</h2>
        
        <div class="row mb-4">
          <div class="col-md-6">
            <label for="stock-bar-select">Sélectionner un bar</label>
            <select class="form-select" id="stock-bar-select">
              <option value="">Tous les bars</option>
            </select>
          </div>
          
          <div class="col-md-6">
            <label for="stock-search">Rechercher un produit</label>
            <input type="text" class="form-control" id="stock-search" placeholder="Nom du produit...">
          </div>
        </div>
        
        <!-- Bouton pour ajouter un produit au stock -->
        <div class="row mb-4">
          <div class="col-12">
            <button class="btn btn-success" id="add-product-to-bar-btn">Ajouter un produit au stock</button>
          </div>
        </div>
        
        <!-- Modal pour ajouter un produit au stock -->
        <div class="modal fade" id="add-product-to-bar-modal">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Ajouter un produit au stock</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="add-product-to-bar-form">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="new-product-bar" class="form-label">Bar</label>
                        <select class="form-select" id="new-product-bar" required>
                          <option value="">Sélectionnez un bar</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="new-product-name" class="form-label">Nom du produit</label>
                        <input type="text" class="form-control" id="new-product-name" required>
                        <small class="form-text text-muted">Vous pouvez saisir un nouveau produit s'il n'existe pas encore</small>
                      </div>
                      <div class="mb-3">
                        <label for="new-product-brand" class="form-label">Marque</label>
                        <input type="text" class="form-control" id="new-product-brand">
                      </div>
                      <div class="mb-3">
                        <label for="new-product-category" class="form-label">Catégorie</label>
                        <select class="form-select" id="new-product-category">
                          <option value="beer">Bière</option>
                          <option value="wine">Vin</option>
                          <option value="spirit">Spiritueux</option>
                          <option value="soft">Soft</option>
                          <option value="other">Autre</option>
                        </select>
                      </div>
                    </div>
                    
                    <div class="col-md-6">
                      <div class="mb-3">
                        <label for="new-product-format" class="form-label">Format</label>
                        <div class="input-group">
                          <select class="form-select" id="new-product-format">
                            <!-- Les options seront chargées dynamiquement -->
                            <option value="">Laisser le système créer un format</option>
                          </select>
                          <button class="btn btn-outline-secondary" type="button" id="create-format-btn" title="Créer un nouveau format">
                            <i class="bi bi-plus-circle"></i> Nouveau
                          </button>
                        </div>
                        <small class="form-text text-muted">Si aucun format n'est sélectionné, un format approprié sera créé automatiquement</small>
                      </div>
                      <div class="mb-3">
                        <label for="new-product-quantity" class="form-label">Quantité initiale</label>
                        <input type="number" class="form-control" id="new-product-quantity" min="0" value="0" required>
                      </div>
                      <div class="mb-3">
                        <label for="new-product-min-quantity" class="form-label">Quantité minimale</label>
                        <input type="number" class="form-control" id="new-product-min-quantity" min="0" value="10" required>
                      </div>
                      <div class="mb-3">
                        <label for="new-product-ideal-quantity" class="form-label">Quantité plein</label>
                        <input type="number" class="form-control" id="new-product-ideal-quantity" min="0" value="30" required>
                      </div>
                    </div>
                  </div>
                  <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Info:</strong> Si vous entrez un nouveau produit qui n'existe pas encore, il sera créé automatiquement avec le format approprié.
                  </div>
                  <div class="text-end">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Ajouter le produit</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>

        <!-- Tableau des stocks -->
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Bar</th>
                <th>Produit</th>
                <th>Format</th>
                <th>Quantité actuelle</th>
                <th>Quantité minimale</th>
                <th>Quantité plein</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="stocks-table-body">
            </tbody>
          </table>
        </div>
      </div>

      <!-- Reserve Page -->
      <div id="reserve-page" class="d-none">
        <div class="d-flex justify-content-between align-items-center">
          <h2>Gestion de la réserve</h2>
          <div>
            <button class="btn btn-success me-2" id="initialize-reserves-btn">
              <i class="bi bi-magic"></i> Initialiser les réserves
            </button>
            <button class="btn btn-primary" id="add-reserve-btn">Ajouter à la réserve</button>
          </div>
        </div>
        
        <!-- Alert pour l'initialisation -->
        <div class="alert alert-info mt-3 d-none" id="initialize-info-alert">
          <i class="bi bi-info-circle me-2"></i>
          <strong>Initialisation des réserves :</strong> Cette action va créer automatiquement une réserve pour chaque format de produit qui n'en a pas encore. Les quantités seront initialement à zéro.
        </div>
        
        <div class="row mb-4">
          <div class="col-md-6">
            <label for="reserve-search">Rechercher un produit</label>
            <input type="text" class="form-control" id="reserve-search" placeholder="Nom du produit...">
          </div>
          <div class="col-md-6">
            <label for="reserve-filter">Filtrer par statut</label>
            <select class="form-select" id="reserve-filter">
              <option value="">Tous les produits</option>
              <option value="low">Stock faible</option>
              <option value="empty">Rupture</option>
              <option value="good">Bon stock</option>
            </select>
          </div>
        </div>
        
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Produit</th>
                <th>Format</th>
                <th>Quantité</th>
                <th>Min</th>
                <th>Max</th>
                <th>Emplacement</th>
                <th>Statut</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="reserve-table-body">
            </tbody>
          </table>
        </div>
      </div>

      <!-- History Page -->
      <div id="history-page" class="d-none">
        <h2>Historique des stocks</h2>
        
        <div class="row mb-4">
          <div class="col-md-4">
            <label for="history-bar-select">Bar</label>
            <select class="form-select" id="history-bar-select">
              <option value="">Tous les bars</option>
            </select>
          </div>
          
          <div class="col-md-4">
            <label for="history-start-date">Date de début</label>
            <input type="date" class="form-control" id="history-start-date">
          </div>
          
          <div class="col-md-4">
            <label for="history-end-date">Date de fin</label>
            <input type="date" class="form-control" id="history-end-date">
          </div>
        </div>
        
        <div class="d-flex justify-content-end mb-3">
          <button class="btn btn-primary" id="load-history-btn">Charger l'historique</button>
        </div>
        
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Bar</th>
                <th>Produit</th>
                <th>Format</th>
                <th>Quantité précédente</th>
                <th>Nouvelle quantité</th>
                <th>Consommation</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody id="history-table-body">
            </tbody>
          </table>
        </div>
      </div>

      <!-- Multi-Reserves Page -->
      <div id="multi-reserves-page" class="d-none">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2>Gestion des réserves multiples</h2>
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-info" id="initialize-default-reserves-btn">
              <i class="bi bi-lightning"></i> Initialiser réserves par défaut
            </button>
            <button type="button" class="btn btn-success" id="add-new-reserve-btn">
              <i class="bi bi-building"></i> Nouvelle réserve
            </button>
            <button type="button" class="btn btn-primary" id="add-reserve-stock-btn">
              <i class="bi bi-plus"></i> Ajouter un stock
            </button>
          </div>
        </div>
        
        <!-- Filtres et statistiques -->
        <div class="row mb-4">
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h6>Filtres</h6>
              </div>
              <div class="card-body">
                <div class="row">
                  <div class="col-md-6">
                    <label for="reserve-type-filter" class="form-label">Type de réserve</label>
                    <select class="form-select" id="reserve-type-filter">
                      <option value="">Tous les types</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label for="reserve-filter" class="form-label">Réserve</label>
                    <select class="form-select" id="reserve-filter">
                      <option value="">Toutes les réserves</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h6>Statistiques des réserves</h6>
              </div>
              <div class="card-body">
                <div class="row text-center">
                  <div class="col-3">
                    <div class="h4 mb-0" id="total-reserves-count">0</div>
                    <small class="text-muted">Réserves</small>
                  </div>
                  <div class="col-3">
                    <div class="h4 mb-0" id="total-capacity-count">0</div>
                    <small class="text-muted">Capacité</small>
                  </div>
                  <div class="col-3">
                    <div class="h4 mb-0" id="total-stock-count">0</div>
                    <small class="text-muted">En stock</small>
                  </div>
                  <div class="col-3">
                    <div class="h4 mb-0 text-warning" id="alerts-count">0</div>
                    <small class="text-muted">Alertes</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tableau des réserves -->
        <div class="card">
          <div class="card-header">
            <h5>Réserves configurées</h5>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Nom</th>
                    <th>Type</th>
                    <th>Température</th>
                    <th>Capacité</th>
                    <th>Emplacement</th>
                    <th>Produits</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="multi-reserves-table-body">
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Stocks par réserve -->
        <div class="card mt-4" id="reserve-stocks-card" style="display: none;">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h5>Stocks - <span id="selected-reserve-name">Réserve</span></h5>
            <button type="button" class="btn btn-sm btn-secondary" id="clear-reserve-selection">
              <i class="bi bi-x"></i> Fermer
            </button>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>Produit</th>
                    <th>Format</th>
                    <th>Quantité</th>
                    <th>Min</th>
                    <th>Max</th>
                    <th>Emplacement</th>
                    <th>Expiration</th>
                    <th>Statut</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="reserve-stocks-table-body">
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Multi-Reserve Modal -->
  <div class="modal fade" id="multi-reserve-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="multi-reserve-modal-title">Nouvelle réserve</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="multi-reserve-form">
            <input type="hidden" id="multi-reserve-id">
            
            <div class="mb-3">
              <label for="multi-reserve-name" class="form-label">Nom de la réserve</label>
              <input type="text" class="form-control" id="multi-reserve-name" required>
            </div>
            
            <div class="mb-3">
              <label for="multi-reserve-type" class="form-label">Type de réserve</label>
              <select class="form-select" id="multi-reserve-type" required>
                <option value="">Sélectionnez un type</option>
                <option value="frigorifique">Frigorifique</option>
                <option value="congelateur">Congélateur</option>
                <option value="sec">Sec (température ambiante)</option>
                <option value="cave">Cave à vin</option>
                <option value="bar">Réserve bar</option>
                <option value="autre">Autre</option>
              </select>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="multi-reserve-temperature" class="form-label">Température</label>
                  <input type="text" class="form-control" id="multi-reserve-temperature" placeholder="ex: +4°C, -18°C, ambiante">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="multi-reserve-capacity" class="form-label">Capacité (unités)</label>
                  <input type="number" class="form-control" id="multi-reserve-capacity" min="0">
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="multi-reserve-location" class="form-label">Emplacement</label>
              <input type="text" class="form-control" id="multi-reserve-location" placeholder="ex: Conteneur 1, Cave, Zone A">
            </div>
            
            <div class="mb-3">
              <label for="multi-reserve-description" class="form-label">Description</label>
              <textarea class="form-control" id="multi-reserve-description" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" id="save-multi-reserve-btn">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Reserve Stock Modal -->
  <div class="modal fade" id="reserve-stock-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reserve-stock-modal-title">Ajouter un stock</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="reserve-stock-form">
            <input type="hidden" id="reserve-stock-id">
            
            <div class="mb-3">
              <label for="reserve-stock-reserve" class="form-label">Réserve</label>
              <select class="form-select" id="reserve-stock-reserve" required>
                <option value="">Sélectionnez une réserve</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="reserve-stock-format" class="form-label">Produit / Format</label>
              <select class="form-select" id="reserve-stock-format" required>
                <option value="">Sélectionnez un produit</option>
              </select>
            </div>
            
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="reserve-stock-quantity" class="form-label">Quantité</label>
                  <input type="number" class="form-control" id="reserve-stock-quantity" min="0" required>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="reserve-stock-min" class="form-label">Quantité min</label>
                  <input type="number" class="form-control" id="reserve-stock-min" min="0" required>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="reserve-stock-max" class="form-label">Quantité max</label>
                  <input type="number" class="form-control" id="reserve-stock-max" min="0" required>
                </div>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="reserve-stock-location" class="form-label">Emplacement</label>
                  <input type="text" class="form-control" id="reserve-stock-location" placeholder="ex: Étagère A, Zone 1">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="reserve-stock-expiration" class="form-label">Date d'expiration</label>
                  <input type="date" class="form-control" id="reserve-stock-expiration">
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="reserve-stock-batch" class="form-label">Numéro de lot</label>
              <input type="text" class="form-control" id="reserve-stock-batch">
            </div>
            
            <div class="mb-3">
              <label for="reserve-stock-notes" class="form-label">Notes</label>
              <textarea class="form-control" id="reserve-stock-notes" rows="2"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" id="save-reserve-stock-btn">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Format Modal -->
  <div class="modal fade" id="format-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="format-modal-title">Nouveau format</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="format-form">
            <input type="hidden" id="format-id">
            <input type="hidden" id="format-product-id">
            
            <!-- Sélecteur de produit (affiché conditionnellement) -->
            <div class="mb-3 d-none" id="format-product-select-container">
              <label for="format-product-select" class="form-label">Produit</label>
              <select class="form-control" id="format-product-select">
                <option value="">Sélectionnez un produit</option>
              </select>
              <small class="form-text text-muted">Sélectionnez le produit pour lequel créer ce format</small>
            </div>
            
            <div class="mb-3">
              <label for="format-size" class="form-label">Taille</label>
              <input type="text" class="form-control" id="format-size" placeholder="ex: 33cl, 75cl, 1L" required>
            </div>
            <div class="mb-3">
              <label for="format-volume" class="form-label">Volume</label>
              <input type="number" class="form-control" id="format-volume" min="0" placeholder="ex: 33, 75, 100" required>
            </div>
            <div class="mb-3">
              <label for="format-unit" class="form-label">Unité</label>
              <select class="form-control" id="format-unit" required>
                <option value="cl">cl</option>
                <option value="ml">ml</option>
                <option value="L">L</option>
                <option value="unité">unité</option>
                <option value="bouteille">bouteille</option>
                <option value="canette">canette</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="format-packaging" class="form-label">Conditionnement</label>
              <select class="form-control" id="format-packaging" required>
                <option value="bouteille">Bouteille</option>
                <option value="canette">Canette</option>
                <option value="verre">Verre</option>
                <option value="fut">Fût</option>
                <option value="bag-in-box">Bag-in-box</option>
                <option value="plastique">Bouteille plastique</option>
                <option value="autre">Autre</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" id="save-format-btn">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Product Modal -->
  <div class="modal fade" id="product-modal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="product-modal-title">Ajouter un produit</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="product-form">
            <input type="hidden" id="product-id">
            
            <!-- Informations de base du produit -->
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="product-name" class="form-label">Nom du produit</label>
                  <input type="text" class="form-control" id="product-name" required>
                </div>
                <div class="mb-3">
                  <label for="product-brand" class="form-label">Marque</label>
                  <input type="text" class="form-control" id="product-brand">
                </div>
                <div class="mb-3">
                  <label for="product-category" class="form-label">Catégorie</label>
                  <select class="form-select" id="product-category" required>
                    <option value="beer">Bière</option>
                    <option value="wine">Vin</option>
                    <option value="spirit">Spiritueux</option>
                    <option value="soft">Soft</option>
                    <option value="other">Autre</option>
                  </select>
                </div>
              </div>
              
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="product-notes" class="form-label">Notes</label>
                  <textarea class="form-control" id="product-notes" rows="2"></textarea>
                </div>
                <div class="form-check mb-3">
                  <input class="form-check-input" type="checkbox" id="product-active" checked>
                  <label class="form-check-label" for="product-active">
                    Produit actif
                  </label>
                </div>
              </div>
            </div>
            
            <!-- Section Formats -->
            <hr>
            <div class="formats-section">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="mb-0">Formats disponibles</h6>
                <button type="button" class="btn btn-sm btn-outline-primary" id="add-format-to-product-btn">
                  <i class="bi bi-plus-circle"></i> Ajouter un format
                </button>
              </div>
              
              <div id="product-formats-list">
                <!-- Les formats existants seront affichés ici -->
                <div class="text-muted small" id="no-formats-message">
                  Aucun format défini pour ce produit. Cliquez sur "Ajouter un format" pour en créer un.
                </div>
              </div>
              
              <!-- Formulaire d'ajout de format (caché par défaut) -->
              <div class="card mt-3 d-none" id="add-format-card">
                <div class="card-header">
                  <h6 class="mb-0">Nouveau format</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-3">
                      <div class="mb-3">
                        <label for="new-format-size" class="form-label">Taille</label>
                        <input type="text" class="form-control" id="new-format-size" placeholder="33cl, 75cl, 1L">
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="mb-3">
                        <label for="new-format-volume" class="form-label">Volume</label>
                        <input type="number" class="form-control" id="new-format-volume" min="0" placeholder="33">
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="mb-3">
                        <label for="new-format-unit" class="form-label">Unité</label>
                        <select class="form-select" id="new-format-unit">
                          <option value="cl">cl</option>
                          <option value="ml">ml</option>
                          <option value="L">L</option>
                          <option value="unité">unité</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="mb-3">
                        <label for="new-format-packaging" class="form-label">Conditionnement</label>
                        <select class="form-select" id="new-format-packaging">
                          <option value="bouteille">Bouteille</option>
                          <option value="canette">Canette</option>
                          <option value="verre">Verre</option>
                          <option value="fut">Fût</option>
                          <option value="bag-in-box">Bag-in-box</option>
                          <option value="plastique">Bouteille plastique</option>
                          <option value="autre">Autre</option>
                        </select>
                      </div>
                    </div>
                    <div class="col-md-2">
                      <div class="mb-3">
                        <label class="form-label">&nbsp;</label>
                        <div class="d-flex gap-1">
                          <button type="button" class="btn btn-sm btn-success" id="save-new-format-btn">
                            <i class="bi bi-check"></i>
                          </button>
                          <button type="button" class="btn btn-sm btn-secondary" id="cancel-new-format-btn">
                            <i class="bi bi-x"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" id="save-product-btn">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Stock Modal -->
  <div class="modal fade" id="stock-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="stock-modal-title">Modifier le stock</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="stock-form">
            <input type="hidden" id="stock-id">
            <div class="mb-3">
              <label for="stock-current-quantity" class="form-label">Quantité actuelle</label>
              <input type="number" class="form-control" id="stock-current-quantity" min="0" required>
            </div>
            <div class="mb-3">
              <label for="stock-min-quantity" class="form-label">Quantité minimale</label>
              <input type="number" class="form-control" id="stock-min-quantity" min="0" required>
            </div>
            <div class="mb-3">
              <label for="stock-ideal-quantity" class="form-label">Quantité plein</label>
              <input type="number" class="form-control" id="stock-ideal-quantity" min="0" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" id="save-stock-btn">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Company Modal -->
  <div class="modal fade" id="company-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="company-modal-title">Ajouter une entreprise</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="company-form">
            <input type="hidden" id="company-id">
            
            <div class="mb-3">
              <label for="company-name" class="form-label">Nom de l'entreprise</label>
              <input type="text" class="form-control" id="company-name" required>
            </div>
            
            <div class="mb-3">
              <label for="company-address" class="form-label">Adresse</label>
              <textarea class="form-control" id="company-address" rows="2"></textarea>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="company-phone" class="form-label">Téléphone</label>
                  <input type="tel" class="form-control" id="company-phone">
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="company-email" class="form-label">Email</label>
                  <input type="email" class="form-control" id="company-email">
                </div>
              </div>
            </div>
            
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="company-active" checked>
              <label class="form-check-label" for="company-active">
                Entreprise active
              </label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" id="save-company-btn">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bar Modal (updated with company selection) -->
  <div class="modal fade" id="bar-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="bar-modal-title">Ajouter un bar</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="bar-form">
            <input type="hidden" id="bar-id">
            
            <div class="mb-3">
              <label for="bar-company" class="form-label">Entreprise</label>
              <select class="form-select" id="bar-company" required>
                <option value="">Sélectionnez une entreprise</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="bar-name" class="form-label">Nom du bar</label>
              <input type="text" class="form-control" id="bar-name" required>
            </div>
            
            <div class="mb-3">
              <label for="bar-location" class="form-label">Emplacement</label>
              <input type="text" class="form-control" id="bar-location">
            </div>
            
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="bar-active" checked>
              <label class="form-check-label" for="bar-active">
                Bar actif
              </label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" id="save-bar-btn">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>

  <!-- Reserve Modal -->
  <div class="modal fade" id="reserve-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reserve-modal-title">Ajouter à la réserve</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="reserve-form">
            <input type="hidden" id="reserve-id">
            
            <div class="mb-3">
              <label for="reserve-format-select" class="form-label">Format</label>
              <select class="form-select" id="reserve-format-select" required>
                <option value="">Sélectionnez un format</option>
              </select>
            </div>
            
            <div class="row">
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="reserve-quantity" class="form-label">Quantité</label>
                  <input type="number" class="form-control" id="reserve-quantity" min="0" required>
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="reserve-min-quantity" class="form-label">Quantité min</label>
                  <input type="number" class="form-control" id="reserve-min-quantity" min="0" value="10">
                </div>
              </div>
              <div class="col-md-4">
                <div class="mb-3">
                  <label for="reserve-max-quantity" class="form-label">Quantité max</label>
                  <input type="number" class="form-control" id="reserve-max-quantity" min="0" value="100">
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="reserve-location" class="form-label">Emplacement</label>
              <input type="text" class="form-control" id="reserve-location" placeholder="ex: Étagère A, Zone 1">
            </div>
            
            <div class="mb-3">
              <label for="reserve-notes" class="form-label">Notes</label>
              <textarea class="form-control" id="reserve-notes" rows="2"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" id="save-reserve-btn">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Transfer Modal -->
  <div class="modal fade" id="transfer-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Transférer vers un bar</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="transfer-form">
            <input type="hidden" id="transfer-reserve-id">
            <input type="hidden" id="transfer-format-id">
            
            <div class="mb-3">
              <label class="form-label">Produit à transférer</label>
              <div class="card card-body bg-light">
                <div id="transfer-product-info">
                  <strong id="transfer-product-name"></strong>
                  <span id="transfer-product-format" class="text-muted"></span>
                  <div class="small">Disponible en réserve: <span id="transfer-available-quantity" class="fw-bold"></span></div>
                </div>
              </div>
            </div>
            
            <div class="mb-3">
              <label for="transfer-bar-select" class="form-label">Bar de destination</label>
              <select class="form-select" id="transfer-bar-select" required>
                <option value="">Sélectionnez un bar</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="transfer-stock-select" class="form-label">Stock de destination</label>
              <select class="form-select" id="transfer-stock-select" required>
                <option value="">Sélectionnez d'abord un bar</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label for="transfer-quantity" class="form-label">Quantité à transférer</label>
              <input type="number" class="form-control" id="transfer-quantity" min="1" required>
              <div class="form-text">Quantité maximale disponible: <span id="transfer-max-quantity"></span></div>
            </div>
            
            <div class="mb-3">
              <label for="transfer-notes" class="form-label">Notes (optionnel)</label>
              <textarea class="form-control" id="transfer-notes" rows="2" placeholder="Motif du transfert..."></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-success" id="confirm-transfer-btn">
            <i class="bi bi-arrow-right-circle"></i> Confirmer le transfert
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Initialize Reserves Modal -->
  <div class="modal fade" id="initialize-reserves-modal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Initialiser les réserves</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="alert alert-info">
            <i class="bi bi-info-circle me-2"></i>
            <strong>Cette action va :</strong>
            <ul class="mb-0 mt-2">
              <li>Créer automatiquement une réserve pour chaque format de produit</li>
              <li>Définir des quantités min/max intelligentes selon la catégorie</li>
              <li>Assigner des emplacements par défaut</li>
              <li>Initialiser les quantités à zéro (à remplir ensuite)</li>
            </ul>
          </div>
          
          <div id="initialization-preview">
            <h6>Aperçu des réserves à créer :</h6>
            <div class="table-responsive">
              <table class="table table-sm">
                <thead>
                  <tr>
                    <th>Produit</th>
                    <th>Format</th>
                    <th>Catégorie</th>
                    <th>Min/Max</th>
                    <th>Emplacement</th>
                  </tr>
                </thead>
                <tbody id="preview-table-body">
                  <tr>
                    <td colspan="5" class="text-center">
                      <div class="spinner-border spinner-border-sm" role="status">
                        <span class="visually-hidden">Chargement...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-success" id="confirm-initialize-btn">
            <i class="bi bi-magic"></i> Confirmer l'initialisation
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Shift Modal -->
  <div class="modal fade" id="shift-modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="shift-modal-title">Enregistrer une fin de service</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="shift-form">
            <input type="hidden" id="shift-stock-id">
            <div class="mb-3">
              <label for="shift-product-info" class="form-label">Produit</label>
              <input type="text" class="form-control" id="shift-product-info" readonly>
            </div>
            <div class="mb-3">
              <label for="shift-previous-quantity" class="form-label">Quantité précédente</label>
              <input type="number" class="form-control" id="shift-previous-quantity" readonly>
            </div>
            <div class="mb-3">
              <label for="shift-new-quantity" class="form-label">Nouvelle quantité</label>
              <input type="number" class="form-control" id="shift-new-quantity" min="0" required>
            </div>
            <div class="mb-3">
              <label for="shift-date" class="form-label">Date</label>
              <input type="date" class="form-control" id="shift-date" required>
            </div>
            <div class="mb-3">
              <label for="shift-name" class="form-label">Nom du service</label>
              <input type="text" class="form-control" id="shift-name" placeholder="ex: Service du soir">
            </div>
            <div class="mb-3">
              <label for="shift-notes" class="form-label">Notes</label>
              <textarea class="form-control" id="shift-notes" rows="2"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
          <button type="button" class="btn btn-primary" id="save-shift-btn">Enregistrer</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/auth.js"></script>
  <script src="js/bar-manager.js"></script>
  <script src="js/product-manager.js"></script>
  <script src="js/history-manager.js"></script>
  <script src="js/responsive-tables.js"></script>
  <script src="js/user-manager.js"></script>
  <script src="js/stock-manager.js"></script>
  <script src="js/app.js"></script>
</body>
</html> 